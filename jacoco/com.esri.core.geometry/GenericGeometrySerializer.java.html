<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GenericGeometrySerializer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Esri Geometry API for Java</a> &gt; <a href="index.source.html" class="el_package">com.esri.core.geometry</a> &gt; <span class="el_source">GenericGeometrySerializer.java</span></div><h1>GenericGeometrySerializer.java</h1><pre class="source lang-java linenums">/*
 Copyright 1995-2015 Esri

   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts Dept
 380 New York Street
 Redlands, California, USA 92373

 email: contracts@esri.com
 */
package com.esri.core.geometry;

import java.io.InvalidObjectException;
import java.io.ObjectStreamException;
import java.io.Serializable;

//This is a writeReplace class for MultiPoint, Polyline, and Polygon
<span class="fc" id="L31">public class GenericGeometrySerializer implements Serializable {</span>
	private static final long serialVersionUID = 1L;
	int geometryType;
<span class="fc" id="L34">	byte[] esriShape = null;</span>
<span class="fc" id="L35">	int simpleFlag = 0;</span>
<span class="fc" id="L36">	double tolerance = 0;</span>
<span class="fc" id="L37">	boolean[] ogcFlags = null;</span>
	
	public Object readResolve() throws ObjectStreamException {
<span class="fc" id="L40">		Geometry geometry = null;</span>
		try {
<span class="fc" id="L42">			geometry = GeometryEngine.geometryFromEsriShape(</span>
<span class="fc" id="L43">					esriShape, Geometry.Type.intToType(geometryType));</span>
			
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">			if (Geometry.isMultiVertex(geometryType)) {</span>
<span class="fc" id="L46">				MultiVertexGeometryImpl mvImpl = (MultiVertexGeometryImpl) geometry</span>
<span class="fc" id="L47">						._getImpl();</span>
<span class="pc bpc" id="L48" title="1 of 2 branches missed.">				if (!geometry.isEmpty()</span>
<span class="fc bfc" id="L49" title="All 2 branches covered.">						&amp;&amp; Geometry.isMultiPath(geometryType)) {</span>
<span class="fc" id="L50">					MultiPathImpl mpImpl = (MultiPathImpl) geometry._getImpl();</span>
<span class="fc" id="L51">					AttributeStreamOfInt8 pathFlags = mpImpl</span>
<span class="fc" id="L52">							.getPathFlagsStreamRef();</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">					for (int i = 0, n = mpImpl.getPathCount(); i &lt; n; i++) {</span>
<span class="fc bfc" id="L54" title="All 2 branches covered.">						if (ogcFlags[i])</span>
<span class="fc" id="L55">							pathFlags.setBits(i,</span>
									(byte) PathFlags.enumOGCStartPolygon);
					}
				}
<span class="fc" id="L59">				mvImpl.setIsSimple(simpleFlag, tolerance, false);</span>
			}
<span class="nc" id="L61">		} catch (Exception ex) {</span>
<span class="nc" id="L62">			throw new InvalidObjectException(&quot;Cannot read geometry from stream&quot;);</span>
<span class="fc" id="L63">		}</span>
<span class="fc" id="L64">		return geometry;</span>
	}

	public void setGeometryByValue(Geometry geometry)
			throws ObjectStreamException {
		try {
<span class="fc" id="L70">			esriShape = GeometryEngine</span>
<span class="fc" id="L71">					.geometryToEsriShape(geometry);</span>
<span class="fc" id="L72">			geometryType = geometry.getType().value();</span>
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">			if (Geometry.isMultiVertex(geometryType)) {</span>
<span class="fc" id="L74">				MultiVertexGeometryImpl mvImpl = (MultiVertexGeometryImpl) geometry</span>
<span class="fc" id="L75">						._getImpl();</span>
<span class="fc" id="L76">				tolerance = mvImpl.m_simpleTolerance;</span>
<span class="fc" id="L77">				simpleFlag = mvImpl.getIsSimple(0);</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">				if (!geometry.isEmpty()</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">						&amp;&amp; Geometry.isMultiPath(geometryType)) {</span>
<span class="fc" id="L80">					MultiPathImpl mpImpl = (MultiPathImpl) geometry._getImpl();</span>
<span class="fc" id="L81">					ogcFlags = new boolean[mpImpl.getPathCount()];</span>
<span class="fc" id="L82">					AttributeStreamOfInt8 pathFlags = mpImpl</span>
<span class="fc" id="L83">							.getPathFlagsStreamRef();</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">					for (int i = 0, n = mpImpl.getPathCount(); i &lt; n; i++) {</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">						ogcFlags[i] = (pathFlags.read(i) &amp; (byte) PathFlags.enumOGCStartPolygon) != 0;</span>
					}
				}

			}
<span class="nc" id="L90">		} catch (Exception ex) {</span>
<span class="nc" id="L91">			throw new InvalidObjectException(&quot;Cannot serialize this geometry&quot;);</span>
<span class="fc" id="L92">		}</span>
<span class="fc" id="L93">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>